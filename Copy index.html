<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>YCATS - Video App</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <style>
    body{font-family:Arial, sans-serif;margin:0;padding:0}
    header{background:#fff;padding:1rem;text-align:center}
    nav ul{list-style:none;margin:0;padding:0;display:flex;justify-content:center;gap:1rem}
    .video-container{padding:20px;display:flex;flex-direction:column;align-items:center}
    .video-feed{display:flex;flex-wrap:wrap;justify-content:center}
    .video-card{margin:10px;width:320px;border-radius:10px;box-shadow:0 0 10px rgba(0,0,0,0.1);overflow:hidden}
    .video-card video{width:100%;height:200px;object-fit:cover}
    .video-info{padding:10px}
    .upload-container{padding:20px;display:flex;flex-direction:column;align-items:center;gap:8px}
    #upload-button{padding:10px 20px;background:#337ab7;color:#fff;border:none;border-radius:5px;cursor:pointer}
  </style>
</head>
<body>
  <header>
    <nav>
      <ul>
        <li><a href="/">Home</a></li>
        <li><a href="#">Discover</a></li>
        <li><a href="#">Upload</a></li>
        <li><a href="#">Profile</a></li>
      </ul>
    </nav>
  </header>

  <main>
    <div class="video-container">
      <div class="video-feed" id="video-feed"></div>
    </div>

    <div class="upload-container">
      <form id="upload-form">
        <input type="file" id="video-file" accept="video/*" required>
        <input type="text" id="video-title" placeholder="Video title">
        <input type="text" id="video-description" placeholder="Video description">
        <button id="upload-button">Upload</button>
      </form>
      <div id="status"></div>
    </div>
  </main>

<script>
const videoFeed = document.getElementById('video-feed');
const uploadForm = document.getElementById('upload-form');
const videoFileInput = document.getElementById('video-file');
const videoTitleInput = document.getElementById('video-title');
const videoDescriptionInput = document.getElementById('video-description');
const status = document.getElementById('status');

// fetch and render video list
async function loadVideos(){
  try{
    const res = await fetch('/videos');
    const videos = await res.json();
    videoFeed.innerHTML = '';
    videos.forEach(v=>{
      const card = document.createElement('div');
      card.className = 'video-card';
      card.innerHTML = `
        <video src="${v.url}" controls></video>
        <div class="video-info"><h3>${escapeHtml(v.title)}</h3><p>${escapeHtml(v.description)}</p></div>
      `;
      videoFeed.appendChild(card);
    });
  }catch(err){
    console.error(err);
  }
}
function escapeHtml(s){ return (s||'').replaceAll('&','&amp;').replaceAll('<','&lt;').replaceAll('>','&gt;') }

uploadForm.addEventListener('submit', async (e)=>{
  e.preventDefault();
  const file = videoFileInput.files[0];
  if(!file){ status.textContent = 'Please choose a file.'; return; }
  const fd = new FormData();
  fd.append('video', file);
  fd.append('title', videoTitleInput.value || '');
  fd.append('description', videoDescriptionInput.value || '');

  status.textContent = 'Uploading...';
  try{
    const res = await fetch('/upload', { method: 'POST', body: fd });
    if(!res.ok){
      const err = await res.json().catch(()=>({error:'upload failed'}));
      status.textContent = `Upload error: ${err.error||res.statusText}`;
      return;
    }
    const data = await res.json();
    status.textContent = 'Upload successful.';
    videoFileInput.value = '';
    videoTitleInput.value = '';
    videoDescriptionInput.value = '';
    loadVideos();
  }catch(err){
    console.error(err);
    status.textContent = 'Upload failed (network).';
  }
});

loadVideos();
</script>
</body>
</html>